<!DOCTYPE html>
<html>
<head>
  <title>4-Box GA Calculator</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    body { font-family: sans-serif; padding: 20px; max-width: 600px; margin: auto; }
    input, button { width: 100%; padding: 10px; margin: 10px 0; font-size: 16px; }
    h2 { text-align: center; }
    pre { background: #f9f9f9; padding: 10px; white-space: pre-wrap; }
  </style>
</head>
<body>

<h2>4-Box GA Calculator with LMP, EDC</h2>

<h3>LMP</h3>
<input type="date" id="lmp" placeholder="LMP (optional)">

<h3>EDC</h3>
<input type="date" id="edc" placeholder="EDC (optional)">

<button onclick="clearLmpEdc()">Clear LMP / EDC</button>

<h3>Known Date / GA</h3>
<input type="date" id="dateA" placeholder="Date A (known GA)">
<input type="text" id="gaA" placeholder="GA on Date A (e.g. 10+3)">

<h3>Calculated Date / GA</h3>
<input type="date" id="dateB" placeholder="Date B (to find GA)">
<input type="text" id="gaB" placeholder="GA on Date B (e.g. 12+0)">

<button onclick="calculate()">Calculate</button>

<pre id="output"></pre>

<script>
function parseGA(gaStr) {
  if (!gaStr) return null;
  const [w, d] = gaStr.split('+').map(Number);
  return w * 7 + (d || 0);
}

function formatGA(days) {
  const weeks = Math.floor(days / 7);
  const remDays = days % 7;
  return `${weeks}+${remDays}`;
}

function formatDate(date) {
  const d = new Date(date);
  const day = String(d.getDate()).padStart(2, '0');
  const month = String(d.getMonth() + 1).padStart(2, '0');
  const year = d.getFullYear();
  return `${day}-${month}-${year}`;
}

function clearLmpEdc() {
  document.getElementById("lmp").value = "";
  document.getElementById("edc").value = "";
}

function calculate() {
  const lmpInput = document.getElementById("lmp");
  const edcInput = document.getElementById("edc");
  const dateAInput = document.getElementById("dateA");
  const dateBInput = document.getElementById("dateB");
  const gaAInput = document.getElementById("gaA");
  const gaBInput = document.getElementById("gaB");
  const out = document.getElementById("output");

  const lmpVal = lmpInput.value;
  const edcVal = edcInput.value;
  const dA = dateAInput.value;
  const dB = dateBInput.value;
  const gaA = parseGA(gaAInput.value);
  const gaB = parseGA(gaBInput.value);

  let lmpDate = lmpVal ? new Date(lmpVal) : null;
  let edcDate = edcVal ? new Date(edcVal) : null;
  let outputLines = [];

  // If only EDC is given, calculate LMP
  if (!lmpDate && edcDate) {
    lmpDate = new Date(edcDate);
    lmpDate.setDate(edcDate.getDate() - 280);
    lmpInput.value = lmpDate.toISOString().slice(0, 10);
    outputLines.push(`LMP (calculated from EDC): ${formatDate(lmpDate)}.`);
  }

  // If only LMP is given, calculate EDC
  if (lmpDate && !edcDate) {
    edcDate = new Date(lmpDate);
    edcDate.setDate(lmpDate.getDate() + 280);
    edcInput.value = edcDate.toISOString().slice(0, 10);
    outputLines.push(`EDC (calculated from LMP): ${formatDate(edcDate)}.`);
  }

  if (lmpDate) {
    outputLines.push(`LMP: ${formatDate(lmpDate)}.`);
    outputLines.push(`EDC: ${formatDate(edcDate)}.`);

    if (dA) {
      const dateA = new Date(dA);
      const diffA = Math.floor((dateA - lmpDate) / (1000 * 60 * 60 * 24));
      const formattedGA = formatGA(diffA);
      outputLines.push(`GA on Date A (${formatDate(dateA)}): ${formattedGA}.`);
      gaAInput.value = formattedGA;
    }

    if (dB) {
      const dateB = new Date(dB);
      const diffB = Math.floor((dateB - lmpDate) / (1000 * 60 * 60 * 24));
      const formattedGA = formatGA(diffB);
      outputLines.push(`GA on Date B (${formatDate(dateB)}): ${formattedGA}.`);
      gaBInput.value = formattedGA;
    }

    out.textContent = outputLines.join("\n");
    return;
  }

  // Fallback: use Date A + GA A to back-calculate LMP
  if (dA && gaA != null) {
    const dateA = new Date(dA);
    lmpDate = new Date(dateA);
    lmpDate.setDate(dateA.getDate() - gaA);
    lmpInput.value = lmpDate.toISOString().slice(0, 10);
    outputLines.push(`LMP (calculated): ${formatDate(lmpDate)}.`);

    edcDate = new Date(lmpDate);
    edcDate.setDate(lmpDate.getDate() + 280);
    edcInput.value = edcDate.toISOString().slice(0, 10);
    outputLines.push(`EDC (calculated): ${formatDate(edcDate)}.`);

    if (dB && gaB == null) {
      const dateB = new Date(dB);
      const diff = (dateB - dateA) / (1000 * 60 * 60 * 24);
      const resultGA = gaA + diff;
      const formattedGA = formatGA(resultGA);
      outputLines.push(`GA on Date B (${formatDate(dateB)}): ${formattedGA}.`);
      gaBInput.value = formattedGA;
    } else if (!dB && gaB != null) {
      const diffDays = gaB - gaA;
      const targetDate = new Date(dateA);
      targetDate.setDate(dateA.getDate() + diffDays);
      const formattedDate = targetDate.toISOString().slice(0, 10);
      outputLines.push(`Date when GA is ${formatGA(gaB)}: ${formatDate(targetDate)}.`);
      dateBInput.value = formattedDate;
    } else if (dB && gaB != null) {
      out.textContent = "Please enter either Date B or GA B, not both.";
      return;
    }

    out.textContent = outputLines.join("\n");
    return;
  }

  out.textContent = "Please enter at least LMP, EDC, or Date A with GA.";
}

document.getElementById("lmp").addEventListener("change", function () {
  const lmpVal = this.value;
  if (lmpVal) {
    const lmpDate = new Date(lmpVal);
    const edcDate = new Date(lmpDate);
    edcDate.setDate(lmpDate.getDate() + 280);
    document.getElementById("edc").value = edcDate.toISOString().slice(0, 10);
  }
});



document.getElementById("edc").addEventListener("change", function() {
  const edcVal = this.value;
  if (edcVal) {
    const edcDate = new Date(edcVal);
    const lmpDate = new Date(edcDate);
    lmpDate.setDate(edcDate.getDate() - 280);
    document.getElementById("lmp").value = lmpDate.toISOString().slice(0, 10);
  }
});


</script>

</body>
</html>
